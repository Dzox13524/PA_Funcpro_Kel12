<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agro API Tester</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg-dark: #121212;
            --bg-card: #1e1e1e;
            --bg-input: #2c2c2c;
            --text-main: #e0e0e0;
            --text-muted: #a0a0a0;
            --primary: #00e676;
            --accent: #2979ff;
            --success: #00e676;
            --error: #f44336;
            --warning: #ff9800;
            --border: #333;

            --method-get: #61affe;
            --method-post: #49cc90;
            --method-put: #fca130;
            --method-patch: #50e3c2;
            --method-delete: #f93e3e;
        }

        body {
            font-family: 'Segoe UI', monospace, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            display: grid;
            grid-template-columns: 300px 1fr;
            height: 100vh;
            overflow: hidden;
        }

        aside {
            background-color: #181818;
            border-right: 1px solid var(--border);
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .auth-box {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .token-display {
            font-size: 0.75rem;
            color: var(--primary);
            word-break: break-all;
            background: #000;
            padding: 5px;
            border-radius: 4px;
            margin-top: 5px;
            max-height: 60px;
            overflow-y: auto;
            display: none;
            font-family: monospace;
        }

        .nav-header {
            font-size: 0.85rem;
            text-transform: uppercase;
            color: var(--text-muted);
            margin-bottom: 10px;
            font-weight: bold;
            letter-spacing: 1px;
            margin-top: 15px;
            border-top: 1px solid #333;
            padding-top: 15px;
        }

        .nav-header:first-of-type {
            border-top: none;
        }

        .nav-item {
            display: block;
            padding: 8px 10px;
            color: var(--text-main);
            text-decoration: none;
            border-radius: 4px;
            margin-bottom: 2px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: 0.2s;
        }

        .nav-item:hover {
            background: #333;
            color: var(--primary);
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            text-align: center;
            font-weight: bold;
        }

        .status-ok {
            background: rgba(0, 230, 118, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .status-no {
            background: rgba(244, 67, 54, 0.1);
            color: var(--error);
            border: 1px solid var(--error);
        }

        main {
            padding: 30px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        h1 {
            margin-top: 0;
            color: var(--primary);
        }

        .section-title {
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
            margin-bottom: 20px;
            margin-top: 40px;
            color: #fff;
            font-size: 1.5rem;
        }

        .api-card {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 5px solid #555;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .api-card.get {
            border-left-color: var(--method-get);
        }

        .api-card.post {
            border-left-color: var(--method-post);
        }

        .api-card.put {
            border-left-color: var(--method-put);
        }

        .api-card.patch {
            border-left-color: var(--method-patch);
        }

        .api-card.delete {
            border-left-color: var(--method-delete);
        }

        .endpoint-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .method-badge {
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.85rem;
            color: #000;
        }

        .get .method-badge {
            background: var(--method-get);
        }

        .post .method-badge {
            background: var(--method-post);
        }

        .put .method-badge {
            background: var(--method-put);
        }

        .patch .method-badge {
            background: var(--method-patch);
        }

        .delete .method-badge {
            background: var(--method-delete);
            color: #fff;
        }

        .url {
            font-family: 'Consolas', monospace;
            font-size: 1.1rem;
            color: var(--text-main);
            word-break: break-all;
        }

        .id-param {
            color: var(--warning);
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.85em;
            color: var(--text-muted);
        }

        input[type="text"],
        textarea,
        select,
        input[type="file"] {
            width: 100%;
            background: var(--bg-input);
            border: 1px solid var(--border);
            color: white;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Consolas', monospace;
            box-sizing: border-box;
        }

        input:focus,
        textarea:focus {
            border-color: var(--primary);
            outline: none;
        }

        textarea {
            height: 100px;
            resize: vertical;
        }

        button {
            background: var(--primary);
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            transition: 0.2s;
        }

        button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        button.secondary {
            background-color: #444;
            color: #fff;
        }

        .response-box {
            background: #000;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
            font-family: 'Consolas', monospace;
            font-size: 0.85rem;
            white-space: pre-wrap;
            display: none;
            border: 1px solid var(--border);
            max-height: 400px;
            overflow-y: auto;
        }

        .response-box.success {
            border-color: var(--success);
            color: #a5d6a7;
        }

        .response-box.error {
            border-color: var(--error);
            color: #ef9a9a;
        }

        .preview-img {
            max-width: 200px;
            margin-top: 15px;
            border-radius: 8px;
            border: 2px solid var(--accent);
            display: none;
        }
    </style>
</head>

<body>

    <aside>
        <h2 style="color:white; margin:0;">üå± Agro API</h2>

        <div class="auth-box">
            <h4 style="margin:0 0 10px 0; color:var(--text-muted);">üîë Auth Status</h4>
            <div id="auth-status-container"></div>

            <label style="margin-top:10px;">Token (JWT):</label>
            <div id="token-display" class="token-display"></div>

            <input type="text" id="manual-token" placeholder="Paste Token disini..."
                style="margin-top:5px; font-size:0.8rem; height: 35px;">

            <div style="display: flex; gap: 5px; margin-top: 10px;">
                <button type="button" onclick="saveTokenManual()" style="flex:1; font-size: 0.8rem;">Set Token</button>
                <button type="button" onclick="logout()" class="secondary"
                    style="flex:1; background:var(--error); font-size: 0.8rem;">Clear</button>
            </div>
        </div>

        <nav>
            <div class="nav-header">1. Users & Auth</div>
            <a href="#register" class="nav-item">Register</a>
            <a href="#login" class="nav-item">Login</a>
            <a href="#get-me" class="nav-item">Get Profile</a>

            <div class="nav-header">2. Marketplace</div>
            <a href="#create-prod" class="nav-item">Create Product</a>
            <a href="#upload-img" class="nav-item">Upload Image</a>
            <a href="#detail-prod" class="nav-item">Detail Product</a>

            <div class="nav-header">3. Forum & QnA</div>
            <a href="#create-q" class="nav-item">Create Question</a>
            <a href="#detail-q" class="nav-item">Detail + Answers</a>

            <div class="nav-header">4. Pest Control</div>
            <a href="#create-alert" class="nav-item">Lapor Hama</a>
            <a href="#map-alert" class="nav-item">Data Sebaran</a>
            <a href="#detail-alert" class="nav-item">Detail Laporan</a>
            <a href="#verify-alert" class="nav-item">Verifikasi</a>

            <div class="nav-header">5. Transactions</div>
            <a href="#create-res" class="nav-item">Buat Reservasi (PO)</a>
            <a href="#create-order" class="nav-item">Buat Order (langsung)</a>
            <a href="#list-res" class="nav-item">List Reservasi Saya</a>
            <a href="#list-orders" class="nav-item">List Order Saya</a>
            <a href="#trans-actions" class="nav-item">Manage Status</a>

            <div class="nav-header">6. Articles</div>
            <a href="#create-article" class="nav-item">Create Article</a>
            <a href="#list-articles" class="nav-item">List Articles</a>
            <a href="#detail-article" class="nav-item">Detail Article</a>
        </nav>
    </aside>

    <main>
        <h1>üöÄ API Documentation & Tester</h1>

        <h2 class="section-title">1. User & Authentication</h2>

        <div class="api-card post" id="register">
            <div class="endpoint-header">
                <span class="method-badge">POST</span>
                <span class="url">/api/v1/auth/register</span>
            </div>
            <p>Mendaftar user baru.</p>
            <div class="input-group">
                <label>Body (JSON)</label>
                <textarea id="body-register">{
  "name": "Petani Kode",
  "email": "petani@example.com",
  "password": "password123"
}</textarea>
            </div>
            <button type="button"
                onclick="sendRequest('register', 'POST', '/api/v1/auth/register', false, event)">Register</button>
            <div id="res-register" class="response-box"></div>
        </div>

        <div class="api-card post" id="login">
            <div class="endpoint-header">
                <span class="method-badge">POST</span>
                <span class="url">/api/v1/auth/login</span>
            </div>
            <p>Login untuk mendapatkan Token JWT. Token otomatis disimpan.</p>
            <div class="input-group">
                <label>Body (JSON)</label>
                <textarea id="body-login">{
  "email": "petani@example.com",
  "password": "password123"
}</textarea>
            </div>
            <button type="button"
                onclick="sendRequest('login', 'POST', '/api/v1/auth/login', false, event)">Login</button>
            <div id="res-login" class="response-box"></div>
        </div>

        <div class="api-card get" id="get-me">
            <div class="endpoint-header">
                <span class="method-badge">GET</span>
                <span class="url">/api/v1/users/me</span>
            </div>
            <p>Melihat profil user yang sedang login (Butuh Token).</p>
            <button type="button" onclick="sendRequest('get-me', 'GET', '/api/v1/users/me', true, event)">Get My
                Profile</button>
            <div id="res-get-me" class="response-box"></div>
        </div>

        <div class="api-card patch" id="update-me">
            <div class="endpoint-header">
                <span class="method-badge">PATCH</span>
                <span class="url">/api/v1/users/me</span>
            </div>
            <p>Update profil user.</p>
            <div class="input-group">
                <label>Body (JSON)</label>
                <textarea id="body-update-me">{
  "name": "Nama Baru Bos"
}</textarea>
            </div>
            <button type="button" onclick="sendRequest('update-me', 'PATCH', '/api/v1/users/me', true, event)">Update
                Profile</button>
            <div id="res-update-me" class="response-box"></div>
        </div>

        <h2 class="section-title">2. Market & Products</h2>

        <div class="api-card post" id="create-prod">
            <div class="endpoint-header">
                <span class="method-badge">POST</span>
                <span class="url">/api/v1/market/products</span>
            </div>
            <p>Membuat postingan produk baru.</p>
            <div class="input-group">
                <label>Body (JSON)</label>
                <textarea id="body-create-prod">{
  "name": "Pupuk Organik Super",
  "description": "Kualitas terbaik untuk padi",
  "price": 50000,
  "stock": 100
}</textarea>
            </div>
            <button type="button"
                onclick="sendRequest('create-prod', 'POST', '/api/v1/market/products', true, event)">Create
                Product</button>
            <div id="res-create-prod" class="response-box"></div>
        </div>

        <div class="api-card post" id="upload-img">
            <div class="endpoint-header">
                <span class="method-badge">POST</span>
                <span class="url">/api/v1/market/products/<span class="id-param">{id}</span>/upload</span>
            </div>
            <h3>üì∏ Upload Gambar (Cloudinary)</h3>
            <p>Upload file gambar untuk produk. Masukkan ID Produk dari hasil Create Product.</p>

            <div class="input-group">
                <label>Product ID</label>
                <input type="text" id="upload-prod-id" placeholder="Paste ID Produk disini...">
            </div>
            <div class="input-group">
                <label>Pilih File Gambar</label>
                <input type="file" id="upload-file-input" accept="image/*">
            </div>

            <button type="button" onclick="uploadImage(event)">Upload ke Cloudinary</button>

            <div id="res-upload" class="response-box"></div>
            <img id="img-preview" class="preview-img" alt="Hasil Upload">
        </div>

        <div class="api-card get" id="detail-prod">
            <div class="endpoint-header">
                <span class="method-badge">GET</span>
                <span class="url">/api/v1/market/products/<span class="id-param">{id}</span></span>
            </div>
            <p>Cek detail produk untuk melihat URL gambar.</p>
            <div class="input-group">
                <label>Product ID</label>
                <input type="text" id="id-detail-prod" placeholder="Product ID...">
            </div>
            <button type="button"
                onclick="sendRequestWithID('detail-prod', 'GET', '/api/v1/market/products/{id}', false, event)">Get
                Detail</button>
            <div id="res-detail-prod" class="response-box"></div>
        </div>

        <h2 class="section-title">3. Forum & QnA</h2>

        <div class="api-card post" id="create-q">
            <div class="endpoint-header">
                <span class="method-badge">POST</span>
                <span class="url">/api/v1/questions</span>
            </div>
            <p>Membuat pertanyaan baru.</p>
            <div class="input-group">
                <label>Body (JSON)</label>
                <textarea id="body-create-q">{
  "title": "Daun padi menguning, kenapa ya?",
  "content": "Sudah 3 hari daun benderanya kuning semua. Mohon bantuannya.",
  "category": "Penyakit"
}</textarea>
            </div>
            <button type="button" onclick="sendRequest('create-q', 'POST', '/api/v1/questions', true, event)">Post
                Question</button>
            <div id="res-create-q" class="response-box"></div>
        </div>

        <div class="api-card get" id="detail-q">
            <div class="endpoint-header">
                <span class="method-badge">GET</span>
                <span class="url">/api/v1/questions/<span class="id-param">{id}</span></span>
            </div>
            <p>Melihat detail pertanyaan beserta jawaban.</p>
            <div class="input-group">
                <label>Question ID</label>
                <input type="text" id="id-detail-q" placeholder="Question UUID...">
            </div>
            <button type="button"
                onclick="sendRequestWithID('detail-q', 'GET', '/api/v1/questions/{id}', true, event)">Get
                Detail</button>
            <div id="res-detail-q" class="response-box"></div>
        </div>

        <div class="api-card post" id="answer-q">
            <div class="endpoint-header">
                <span class="method-badge">POST</span>
                <span class="url">/api/v1/questions/<span class="id-param">{id}</span>/answers</span>
            </div>
            <p>Menjawab pertanyaan.</p>
            <div class="input-group">
                <label>Question ID</label>
                <input type="text" id="id-answer-q" placeholder="Question UUID...">
            </div>
            <div class="input-group">
                <label>Body (JSON)</label>
                <textarea id="body-answer-q">{
  "content": "Coba cek pangkal batangnya, mungkin ada wereng."
}</textarea>
            </div>
            <button type="button"
                onclick="sendRequestWithID('answer-q', 'POST', '/api/v1/questions/{id}/answers', true, event)">Submit
                Answer</button>
            <div id="res-answer-q" class="response-box"></div>
        </div>

        <div class="api-card post" id="like-q">
            <div class="endpoint-header">
                <span class="method-badge">POST</span>
                <span class="url">/api/v1/questions/<span class="id-param">{id}</span>/like</span>
            </div>
            <p>Like / Unlike pertanyaan.</p>
            <div class="input-group">
                <label>Question ID</label>
                <input type="text" id="id-like-q" placeholder="Question UUID...">
            </div>
            <button type="button"
                onclick="sendRequestWithID('like-q', 'POST', '/api/v1/questions/{id}/like', true, event)">Toggle
                Like</button>
            <div id="res-like-q" class="response-box"></div>
        </div>

        <h2 class="section-title">4. Pest Control (Laporan Hama)</h2>

        <div class="api-card post" id="create-alert">
            <div class="endpoint-header">
                <span class="method-badge">POST</span>
                <span class="url">/api/v1/alerts</span>
            </div>
            <p>Melaporkan kejadian hama baru (Perlu Login).</p>
            <div class="input-group">
                <label>Body (JSON)</label>
                <textarea id="body-create-alert">{
  "pest_name": "Wereng Batang Coklat",
  "description": "Menyerang area sawah petak selatan, padi mulai kering.",
  "city": "Jember",
  "severity": "high"
}</textarea>
            </div>
            <button type="button" onclick="sendRequest('create-alert', 'POST', '/api/v1/alerts', true, event)">Lapor
                Hama</button>
            <div id="res-create-alert" class="response-box"></div>
        </div>

        <div class="api-card get" id="map-alert">
            <div class="endpoint-header">
                <span class="method-badge">GET</span>
                <span class="url">/api/v1/alerts/map</span>
            </div>
            <p>Mengambil semua data laporan hama.</p>
            <button type="button" onclick="sendRequest('map-alert', 'GET', '/api/v1/alerts/map', false, event)">Get All
                Alerts</button>
            <div id="res-map-alert" class="response-box"></div>
        </div>

        <div class="api-card get" id="detail-alert">
            <div class="endpoint-header">
                <span class="method-badge">GET</span>
                <span class="url">/api/v1/alerts/<span class="id-param">{id}</span></span>
            </div>
            <p>Melihat detail satu laporan hama.</p>
            <div class="input-group">
                <label>Alert ID</label>
                <input type="text" id="id-detail-alert" placeholder="Alert UUID...">
            </div>
            <button type="button"
                onclick="sendRequestWithID('detail-alert', 'GET', '/api/v1/alerts/{id}', false, event)">Get Detail
                Alert</button>
            <div id="res-detail-alert" class="response-box"></div>
        </div>

        <div class="api-card post" id="verify-alert">
            <div class="endpoint-header">
                <span class="method-badge">POST</span>
                <span class="url">/api/v1/alerts/<span class="id-param">{id}</span>/verify</span>
            </div>
            <p>Verifikasi laporan (Increment Verification Count).</p>
            <div class="input-group">
                <label>Alert ID</label>
                <input type="text" id="id-verify-alert" placeholder="Alert UUID...">
            </div>
            <button type="button"
                onclick="sendRequestWithID('verify-alert', 'POST', '/api/v1/alerts/{id}/verify', true, event)">Verifikasi</button>
            <div id="res-verify-alert" class="response-box"></div>
        </div>

        <h2 class="section-title">5. Transactions (Order & Reservasi)</h2>

        <div class="api-card post" id="create-res">
            <div class="endpoint-header">
                <span class="method-badge">POST</span>
                <span class="url">/api/v1/market/reservations</span>
            </div>
            <p>Membuat <b>Reservasi (Pre-Order)</b> untuk produk yang stoknya tersedia.</p>
            <div class="input-group">
                <label>Product ID (Wajib)</label>
                <input type="text" id="res-prod-id" placeholder="Copy Product ID dari hasil Create Product...">
            </div>
            <div class="input-group">
                <label>Body (JSON)</label>
                <textarea id="body-create-res">{
  "product_id": "PASTE_ID_DISINI_JIKA_INPUT_ATAS_KOSONG",
  "quantity": 10,
  "note": "Tolong dibungkus karung goni ya"
}</textarea>
            </div>
            <button type="button" onclick="createReservation(event)">Buat Reservasi</button>
            <div id="res-create-res" class="response-box"></div>
        </div>

        <div class="api-card post" id="create-order">
            <div class="endpoint-header">
                <span class="method-badge">POST</span>
                <span class="url">/api/v1/market/orders</span>
            </div>
            <p>Membuat <b>Direct Order (Beli Langsung)</b>.</p>
            <div class="input-group">
                <label>Product ID</label>
                <input type="text" id="order-prod-id" placeholder="Product ID...">
            </div>
            <div class="input-group">
                <label>Body (JSON)</label>
                <textarea id="body-create-order">{
  "product_id": "PASTE_ID_DISINI_JIKA_INPUT_ATAS_KOSONG",
  "quantity": 2,
  "note": "Kirim via JNE ya gan"
}</textarea>
            </div>
            <button type="button" onclick="createOrder(event)">Buat Order</button>
            <div id="res-create-order" class="response-box"></div>
        </div>

        <div class="api-card get" id="list-res">
            <div class="endpoint-header">
                <span class="method-badge">GET</span>
                <span class="url">/api/v1/users/me/reservations</span>
            </div>
            <p>Melihat daftar Reservasi (Pre-Order) saya.</p>
            <button type="button"
                onclick="sendRequest('list-res', 'GET', '/api/v1/users/me/reservations', true, event)">List My
                Reservations</button>
            <div id="res-list-res" class="response-box"></div>
        </div>

        <div class="api-card get" id="list-orders">
            <div class="endpoint-header">
                <span class="method-badge">GET</span>
                <span class="url">/api/v1/users/me/orders</span>
            </div>
            <p>Melihat daftar Order (Pesanan Biasa) saya.</p>
            <button type="button"
                onclick="sendRequest('list-orders', 'GET', '/api/v1/users/me/orders', true, event)">List My
                Orders</button>
            <div id="res-list-orders" class="response-box"></div>
        </div>

        <div class="api-card get" id="detail-trans">
            <div class="endpoint-header">
                <span class="method-badge">GET</span>
                <span class="url">/api/v1/market/orders/<span class="id-param">{id}</span></span>
            </div>
            <p>Melihat detail transaksi (Order atau Reservasi) berdasarkan ID.</p>
            <div class="input-group">
                <label>Transaction ID</label>
                <input type="text" id="id-detail-trans" placeholder="Transaction UUID...">
            </div>
            <button type="button"
                onclick="sendRequestWithID('detail-trans', 'GET', '/api/v1/market/orders/{id}', true, event)">Get Detail
                Transaction</button>
            <div id="res-detail-trans" class="response-box"></div>
        </div>

        <div id="trans-actions"></div>

        <div class="api-card post" id="confirm-res">
            <div class="endpoint-header">
                <span class="method-badge">POST</span>
                <span class="url">/api/v1/market/reservations/<span class="id-param">{id}</span>/confirm</span>
            </div>
            <p>Mengkonfirmasi Reservasi (Status -> confirmed).</p>
            <div class="input-group">
                <label>Transaction ID</label>
                <input type="text" id="id-confirm-res" placeholder="Transaction UUID...">
            </div>
            <button type="button"
                onclick="sendRequestWithID('confirm-res', 'POST', '/api/v1/market/reservations/{id}/confirm', true, event)">Confirm
                Reservation</button>
            <div id="res-confirm-res" class="response-box"></div>
        </div>

        <div class="api-card post" id="cancel-res">
            <div class="endpoint-header">
                <span class="method-badge">POST</span>
                <span class="url">/api/v1/market/reservations/<span class="id-param">{id}</span>/cancel</span>
            </div>
            <p>Membatalkan Reservasi (Status -> cancelled).</p>
            <div class="input-group">
                <label>Transaction ID</label>
                <input type="text" id="id-cancel-res" placeholder="Transaction UUID...">
            </div>
            <button type="button"
                onclick="sendRequestWithID('cancel-res', 'POST', '/api/v1/market/reservations/{id}/cancel', true, event)">Cancel
                Reservation</button>
            <div id="res-cancel-res" class="response-box"></div>
        </div>

        <div class="api-card patch" id="update-res-status">
            <div class="endpoint-header">
                <span class="method-badge">PATCH</span>
                <span class="url">/api/v1/market/reservations/<span class="id-param">{id}</span>/status</span>
            </div>
            <p>Update Status Reservasi Manual (Misal: 'shipped' saat panen dikirim).</p>
            <div class="input-group">
                <label>Transaction ID (Reservasi)</label>
                <input type="text" id="id-update-res" placeholder="Reservation UUID...">
            </div>
            <div class="input-group">
                <label>Body (JSON)</label>
                <textarea id="body-update-res">{
  "status": "shipped"
}</textarea>
            </div>
            <button type="button"
                onclick="sendRequestWithID('update-res-status', 'PATCH', '/api/v1/market/reservations/{id}/status', true, event)">Update
                Status Reservasi</button>
            <div id="res-update-res-status" class="response-box"></div>
        </div>

        <div class="api-card patch" id="update-order-status">
            <div class="endpoint-header">
                <span class="method-badge">PATCH</span>
                <span class="url">/api/v1/market/orders/<span class="id-param">{id}</span>/status</span>
            </div>
            <p>Update Status Order Manual (Misal: shipped, completed).</p>
            <div class="input-group">
                <label>Transaction ID (Order)</label>
                <input type="text" id="id-update-order" placeholder="Order UUID...">
            </div>
            <div class="input-group">
                <label>Body (JSON)</label>
                <textarea id="body-update-order">{
  "status": "shipped"
}</textarea>
            </div>
            <button type="button"
                onclick="sendRequestWithID('update-order-status', 'PATCH', '/api/v1/market/orders/{id}/status', true, event)">Update
                Status Order</button>
            <div id="res-update-order-status" class="response-box"></div>
        </div>

        <h2 class="section-title">6. Articles (Blog/Berita)</h2>

        <div class="api-card post" id="create-article">
            <div class="endpoint-header">
                <span class="method-badge">POST</span>
                <span class="url">/api/v1/articles</span>
            </div>
            <p>Membuat artikel baru (Butuh Login).</p>
            <div class="input-group">
                <label>Body (JSON)</label>
                <textarea id="body-create-article">{
  "title": "Tips Menanam Cabai",
  "content": "Pertama, siapkan tanah yang gembur..."
}</textarea>
            </div>
            <button type="button"
                onclick="sendRequest('create-article', 'POST', '/api/v1/articles', true, event)">Create Article</button>
            <div id="res-create-article" class="response-box"></div>
        </div>

        <div class="api-card get" id="list-articles">
            <div class="endpoint-header">
                <span class="method-badge">GET</span>
                <span class="url">/api/v1/articles</span>
            </div>
            <p>Melihat semua daftar artikel.</p>
            <button type="button" onclick="sendRequest('list-articles', 'GET', '/api/v1/articles', false, event)">Get
                All Articles</button>
            <div id="res-list-articles" class="response-box"></div>
        </div>

        <div class="api-card get" id="detail-article">
            <div class="endpoint-header">
                <span class="method-badge">GET</span>
                <span class="url">/api/v1/articles/<span class="id-param">{id}</span></span>
            </div>
            <p>Melihat detail artikel berdasarkan ID.</p>
            <div class="input-group">
                <label>Article ID</label>
                <input type="text" id="id-detail-article" placeholder="Article UUID...">
            </div>
            <button type="button"
                onclick="sendRequestWithID('detail-article', 'GET', '/api/v1/articles/{id}', false, event)">Get Detail
                Article</button>
            <div id="res-detail-article" class="response-box"></div>
        </div>
    </main>

    <script>
        const BASE_URL = "http://localhost:8080";
        let authToken = localStorage.getItem('authToken') || "";

        updateAuthUI();

        function updateAuthUI() {
            const statusContainer = document.getElementById('auth-status-container');
            const tokenDisplay = document.getElementById('token-display');
            const tokenInput = document.getElementById('manual-token');

            if (authToken) {
                statusContainer.innerHTML = `<div class="status-badge status-ok">‚úÖ TERAUTENTIKASI</div>`;
                tokenDisplay.innerText = authToken;
                tokenDisplay.style.display = 'block';
                tokenInput.value = authToken;
            } else {
                statusContainer.innerHTML = `<div class="status-badge status-no">‚ùå BELUM LOGIN</div>`;
                tokenDisplay.innerText = '';
                tokenDisplay.style.display = 'none';
                tokenInput.value = '';
            }
        }

        function saveTokenManual() {
            const val = document.getElementById('manual-token').value.trim();
            if (val) {
                authToken = val;
                localStorage.setItem('authToken', val);
                alert("Token saved manually!");
            }
            updateAuthUI();
        }

        function logout() {
            authToken = "";
            localStorage.removeItem('authToken');
            updateAuthUI();
        }

        async function sendRequest(elementId, method, endpoint, requiresAuth = false, event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }

            const resBox = document.getElementById(`res-${elementId}`);

            resBox.style.display = 'block';
            resBox.innerText = 'Loading...';
            resBox.className = 'response-box';

            setTimeout(() => {
                resBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);

            const headers = { 'Content-Type': 'application/json' };
            if (requiresAuth) {
                if (!authToken) {
                    resBox.innerText = "Error: Token kosong! Silakan Login dulu.";
                    resBox.classList.add('error');
                    return;
                }
                headers['Authorization'] = `Bearer ${authToken}`;
            }

            let body = null;
            if (['POST', 'PUT', 'PATCH'].includes(method)) {
                const bodyInput = document.getElementById(`body-${elementId}`);
                if (bodyInput && bodyInput.value.trim()) {
                    try {
                        const raw = bodyInput.value;
                        JSON.parse(raw);
                        body = raw;
                    } catch (e) {
                        resBox.innerText = "Error: JSON Body tidak valid (Syntax Error).\n" + e.message;
                        resBox.classList.add('error');
                        return;
                    }
                }
            }

            try {
                const response = await fetch(BASE_URL + endpoint, {
                    method: method,
                    headers: headers,
                    body: body
                });

                const data = await response.json();
                const output = `Status: ${response.status} ${response.statusText}\n\n` + JSON.stringify(data, null, 2);
                resBox.innerText = output;

                if (response.ok) {
                    resBox.classList.add('success');

                    if (elementId === 'login' && data.data && data.data.token) {
                        authToken = data.data.token;
                        localStorage.setItem('authToken', authToken);
                        updateAuthUI();
                    }

                    if (data.data && data.data.id) {
                        const newId = data.data.id;

                        if (elementId === 'create-alert') {
                            if (document.getElementById('id-detail-alert')) document.getElementById('id-detail-alert').value = newId;
                            if (document.getElementById('id-verify-alert')) document.getElementById('id-verify-alert').value = newId;
                        }
                        if (elementId === 'create-prod') {
                            if (document.getElementById('upload-prod-id')) document.getElementById('upload-prod-id').value = newId;
                            if (document.getElementById('id-detail-prod')) document.getElementById('id-detail-prod').value = newId;
                            if (document.getElementById('res-prod-id')) document.getElementById('res-prod-id').value = newId;
                            if (document.getElementById('order-prod-id')) document.getElementById('order-prod-id').value = newId;
                        }
                        if (elementId === 'create-q') {
                            if (document.getElementById('id-detail-q')) document.getElementById('id-detail-q').value = newId;
                            if (document.getElementById('id-answer-q')) document.getElementById('id-answer-q').value = newId;
                            if (document.getElementById('id-like-q')) document.getElementById('id-like-q').value = newId;
                        }
                        if (elementId === 'create-res') {
                            if (document.getElementById('id-detail-trans')) document.getElementById('id-detail-trans').value = newId;
                            if (document.getElementById('id-confirm-res')) document.getElementById('id-confirm-res').value = newId;
                            if (document.getElementById('id-cancel-res')) document.getElementById('id-cancel-res').value = newId;
                            if (document.getElementById('id-update-res')) document.getElementById('id-update-res').value = newId;
                        }
                        if (elementId === 'create-order') {
                            if (document.getElementById('id-detail-trans')) document.getElementById('id-detail-trans').value = newId;
                            if (document.getElementById('id-update-order')) document.getElementById('id-update-order').value = newId;
                        }

                        /* ======================= LOGIKA AUTO-FILL ID ARTIKEL ======================= */
                        if (elementId === 'create-article') {
                            if (document.getElementById('id-detail-article')) {
                                document.getElementById('id-detail-article').value = newId;
                            }
                        }
                        /* =========================================================================== */

                        resBox.innerText += "\n\n[INFO] ID berhasil disalin otomatis ke form terkait!";
                    }
                } else {
                    resBox.classList.add('error');
                }

            } catch (err) {
                resBox.innerText = `Network Error: ${err.message}\n(Pastikan server Go jalan di ${BASE_URL})`;
                resBox.classList.add('error');
            }

            resBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        async function createReservation(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }

            const prodIdInput = document.getElementById('res-prod-id').value.trim();
            const bodyInput = document.getElementById('body-create-res');
            let bodyJson = bodyInput.value;

            if (prodIdInput) {
                try {
                    const obj = JSON.parse(bodyJson);
                    obj.product_id = prodIdInput;
                    bodyJson = JSON.stringify(obj, null, 2);
                    bodyInput.value = bodyJson;
                } catch (e) {
                    console.error("JSON Error parsing body for reservation");
                }
            }

            sendRequest('create-res', 'POST', '/api/v1/market/reservations', true, null);
        }

        async function createOrder(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }

            const prodIdInput = document.getElementById('order-prod-id').value.trim();
            const bodyInput = document.getElementById('body-create-order');
            let bodyJson = bodyInput.value;

            if (prodIdInput) {
                try {
                    const obj = JSON.parse(bodyJson);
                    obj.product_id = prodIdInput;
                    bodyJson = JSON.stringify(obj, null, 2);
                    bodyInput.value = bodyJson;
                } catch (e) {
                    console.error("JSON Error parsing body for order");
                }
            }

            sendRequest('create-order', 'POST', '/api/v1/market/orders', true, null);
        }

        async function sendRequestWithID(elementId, method, endpointTemplate, requiresAuth = false, event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }

            const idInput = document.getElementById(`id-${elementId}`);
            if (!idInput || !idInput.value.trim()) {
                alert("Masukkan ID terlebih dahulu!");
                return;
            }
            const realEndpoint = endpointTemplate.replace('{id}', idInput.value.trim());

            const resBox = document.getElementById(`res-${elementId}`);

            resBox.style.display = 'block';
            resBox.innerText = 'Loading...';
            resBox.className = 'response-box';

            setTimeout(() => {
                resBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);

            const headers = { 'Content-Type': 'application/json' };
            if (requiresAuth) {
                if (!authToken) {
                    resBox.innerText = "Error: Token kosong! Silakan Login dulu.";
                    resBox.classList.add('error');
                    return;
                }
                headers['Authorization'] = `Bearer ${authToken}`;
            }

            let body = null;
            if (['POST', 'PUT', 'PATCH'].includes(method)) {
                const bodyInput = document.getElementById(`body-${elementId}`);
                if (bodyInput && bodyInput.value.trim()) {
                    try {
                        JSON.parse(bodyInput.value);
                        body = bodyInput.value;
                    } catch (e) {
                        resBox.innerText = "Error: JSON tidak valid.\n" + e.message;
                        resBox.classList.add('error');
                        return;
                    }
                }
            }

            try {
                const response = await fetch(BASE_URL + realEndpoint, {
                    method: method,
                    headers: headers,
                    body: body
                });

                const data = await response.json();
                const output = `Status: ${response.status} ${response.statusText}\n\n` + JSON.stringify(data, null, 2);
                resBox.innerText = output;

                if (response.ok) {
                    resBox.classList.add('success');
                } else {
                    resBox.classList.add('error');
                }

            } catch (err) {
                resBox.innerText = `Network Error: ${err.message}`;
                resBox.classList.add('error');
            }

            resBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        async function uploadImage(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }

            const id = document.getElementById('upload-prod-id').value.trim();
            const fileInput = document.getElementById('upload-file-input');
            const resArea = document.getElementById('res-upload');
            const imgPreview = document.getElementById('img-preview');

            resArea.style.display = 'block';
            resArea.innerText = 'Uploading...';
            resArea.className = 'response-box';
            imgPreview.style.display = 'none';

            if (!authToken) return alert("Login dulu!");
            if (!id) return alert("Product ID kosong!");
            if (!fileInput.files[0]) return alert("Pilih file gambar!");

            const formData = new FormData();
            formData.append("image", fileInput.files[0]);

            try {
                const response = await fetch(`${BASE_URL}/api/v1/market/products/${id}/upload`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });

                const data = await response.json();
                resArea.innerText = `Status: ${response.status}\n\n` + JSON.stringify(data, null, 2);

                if (response.ok) {
                    resArea.classList.add('success');
                    if (data.data && data.data.image_url) {
                        imgPreview.src = data.data.image_url;
                        imgPreview.style.display = 'block';
                    }
                } else {
                    resArea.classList.add('error');
                }
            } catch (err) {
                resArea.innerText = `Error: ${err.message}`;
                resArea.classList.add('error');
            }
        }
    </script>
</body>

</html>